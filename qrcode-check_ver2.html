<!DOCTYPE html>
<html lang="ja">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>ETCã‚«ãƒ¼ãƒ‰ç•ªå·ç…§åˆãƒ„ãƒ¼ãƒ«</title>
Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: sans-serif;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  background-color: #f4f4f4;
Â  Â  Â  Â  }
Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  p {
Â  Â  Â  Â  Â  Â  margin-top: 0;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  }
Â  Â  Â  Â  #video-container {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 500px;
Â  Â  Â  Â  Â  Â  margin: 20px auto;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  background-color: #000;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  max-height: 200px;
Â  Â  Â  Â  Â  Â  height: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  video {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: auto;
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  position: static;
Â  Â  Â  Â  Â  Â  top: auto;
Â  Â  Â  Â  Â  Â  left: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  canvas {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: auto;
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  object-fit: contain;
Â  Â  Â  Â  }
Â  Â  Â  Â  #controls {
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: flex-start; /* ğŸ‘ˆ ä¿®æ­£: å·¦å¯„ã›ã«ã™ã‚‹ */
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  max-width: 500px; /* ğŸ‘ˆ è¿½åŠ : è¦ªè¦ç´ ã¨å¹…ã‚’åˆã‚ã›ã‚‹ */
Â  Â  Â  Â  Â  Â  margin: 10px auto; /* ğŸ‘ˆ è¿½åŠ : ä¸­å¤®å¯„ã›ã«ã™ã‚‹ */
Â  Â  Â  Â  }
Â  Â  Â  Â  #controls button {
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  background-color: #007bff;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  #controls button:nth-of-type(1) { /* ğŸ‘ˆ è¿½åŠ : æœ€åˆã®ãƒœã‚¿ãƒ³ï¼ˆQR1ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª¿æ•´ */
Â  Â  Â  Â  Â  Â  margin-right: 5px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #controls button:nth-of-type(2) { /* ğŸ‘ˆ è¿½åŠ : 2ç•ªç›®ã®ãƒœã‚¿ãƒ³ï¼ˆQR2ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª¿æ•´ */
Â  Â  Â  Â  Â  Â  margin-right: auto; /* ğŸ‘ˆ ä¿®æ­£: å³ãƒãƒ¼ã‚¸ãƒ³ã‚’è‡ªå‹•ã§è¨­å®šã—ã¦å³ã«å¯„ã›ã‚‹ */
Â  Â  Â  Â  }
Â  Â  Â  Â  #controls button:nth-of-type(3) {
Â  Â  Â  Â  Â  Â  margin-left: 10px; /* ğŸ‘ˆ ä¿®æ­£: ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®å·¦ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ  */
Â  Â  Â  Â  }
Â  Â  Â  Â  #controls button:hover:not(:disabled) {
Â  Â  Â  Â  Â  Â  background-color: #0056b3;
Â  Â  Â  Â  }
Â  Â  Â  Â  #controls button:disabled {
Â  Â  Â  Â  Â  Â  background-color: #cccccc;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  }
Â  Â  Â  Â  #results {
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  Â  Â  max-width: 500px;
Â  Â  Â  Â  Â  Â  margin-left: auto;
Â  Â  Â  Â  Â  Â  margin-right: auto;
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  #results p {
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  padding-bottom: 10px;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #eee;
Â  Â  Â  Â  }
Â  Â  Â  Â  #results p:last-of-type {
Â  Â  Â  Â  Â  Â  border-bottom: none;
Â  Â  Â  Â  Â  Â  padding-bottom: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .status {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .scanned-code {
Â  Â  Â  Â  Â  Â  word-break: break-all;
Â  Â  Â  Â  Â  Â  font-family: monospace;
Â  Â  Â  Â  Â  Â  background-color: #e9e9e9;
Â  Â  Â  Â  Â  Â  padding: 5px;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  margin-left: 5px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  #comparison-block-result {
Â  Â  Â  Â  Â  Â  font-size: 3em;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  padding: 15px 10px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  #comparison-block-result.match {
Â  Â  Â  Â  Â  Â  background-color: green;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  #comparison-block-result.mismatch {
Â  Â  Â  Â  Â  Â  background-color: red;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  #comparison-secondary-message {
Â  Â  Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  #comparison-secondary-message.match {
Â  Â  Â  Â  Â  Â  color: green;
Â  Â  Â  Â  }
Â  Â  Â  Â  #comparison-secondary-message.mismatch {
Â  Â  Â  Â  Â  Â  color: red;
Â  Â  Â  Â  }
Â  Â  Â  Â  #camera-error {
Â  Â  Â  Â  Â  Â  color: red;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* è¿½åŠ : ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
Â  Â  Â  Â  #data-input {
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  max-width: 500px;
Â  Â  Â  Â  Â  Â  margin-left: auto;
Â  Â  Â  Â  Â  Â  margin-right: auto;
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  #data-input label {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #data-input input[type="text"] {
Â  Â  Â  Â  Â  Â  width: 80%;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #data-input button {
Â  Â  Â  Â  Â  Â  width: 85%;
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  background-color: #28a745;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  #data-input button:hover:not(:disabled) {
Â  Â  Â  Â  Â  Â  background-color: #218838;
Â  Â  Â  Â  }
Â  Â  Â  Â  #data-input button:disabled {
Â  Â  Â  Â  Â  Â  background-color: #cccccc;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  }
Â  Â  Â  Â  #send-status-message {
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <h1>ETCã‚«ãƒ¼ãƒ‰ç•ªå·<br>ç…§åˆãƒ„ãƒ¼ãƒ«</h1>
Â  Â  <p>ETCã‚«ãƒ¼ãƒ‰åŠã³è»Šè¼‰å™¨ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãã ã•ã„ã€‚</p>

Â  Â  <div id="video-container">
Â  Â  Â  Â  <video id="qr-video" autoplay playsinline></video>
Â  Â  Â  Â  <canvas id="qr-canvas"></canvas>
Â  Â  </div>

Â  Â  <div id="camera-error" style="display: none;">
Â  Â  Â  Â  ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>
Â  Â  Â  Â  ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰é–‹ãå¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆhttp:// ã¾ãŸã¯ https://ï¼‰ã€‚<br>
Â  Â  Â  Â  ã¾ãŸã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚µã‚¤ãƒˆè¨­å®šã§ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚<br>
Â  Â  Â  Â  ï¼ˆè©³ç´°ãªã‚¨ãƒ©ãƒ¼: ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ï¼‰
Â  Â  </div>

Â  Â  <div id="controls">
Â  Â  Â  Â  <button id="scan1-button">QRã‚³ãƒ¼ãƒ‰ï¼ˆï¼‘ï¼‰ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹</button>
Â  Â  Â  Â  <button id="scan2-button" disabled>QRã‚³ãƒ¼ãƒ‰ï¼ˆï¼’ï¼‰ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹</button>
Â  Â  Â  Â  <button id="reset-button">ãƒªã‚»ãƒƒãƒˆ</button>
Â  Â  </div>

Â  Â  <div id="results">
Â  Â  Â  Â  <p id="current-time-display"></p>
Â  Â  Â  Â  <p><span class="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</span> <span id="scan-status">ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™...</span></p>
Â  Â  Â  Â  <p><span class="status">QR1:</span> <span id="code1-result">---</span></p>
Â  Â  Â  Â  <p><span class="status">QR2:</span> <span id="code2-result">---</span></p>
Â  Â  Â  Â  <p><span class="status">ç…§åˆçµæœ:</span></p>
Â  Â  Â  Â  <div id="comparison-block-result">---</div>
Â  Â  Â  Â  <p id="comparison-secondary-message">---</p>
Â  Â  </div>

Â  Â  <div id="data-input">
Â  Â  Â  Â  <label for="performer-name">å®Ÿæ–½è€…å</label>
Â  Â  Â  Â  <input type="text" id="performer-name" placeholder="æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" required>
Â  Â  Â  Â  <label for="verifier-name">ç¢ºèªè€…å</label>
Â  Â  Â  Â  <input type="text" id="verifier-name" placeholder="æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" required>
Â  Â  Â  Â  <button id="send-data-button" disabled>ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹</button>
Â  Â  Â  Â  <p id="send-status-message"></p>
Â  Â  </div>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.1.1/dist/jsQR.min.js"></script>
Â  Â  <script>
Â  Â  Â  Â  const video = document.getElementById('qr-video');
Â  Â  Â  Â  const canvas = document.getElementById('qr-canvas');
Â  Â  Â  Â  const canvasContext = canvas.getContext('2d');
Â  Â  Â  Â  const scanStatusSpan = document.getElementById('scan-status');
Â  Â  Â  Â  const code1ResultSpan = document.getElementById('code1-result');
Â  Â  Â  Â  const code2ResultSpan = document.getElementById('code2-result');
Â  Â  Â  Â  const scan1Button = document.getElementById('scan1-button');
Â  Â  Â  Â  const scan2Button = document.getElementById('scan2-button');
Â  Â  Â  Â  const resetButton = document.getElementById('reset-button');
Â  Â  Â  Â  const cameraErrorDiv = document.getElementById('camera-error');
Â  Â  Â  Â  const comparisonBlockResultDiv = document.getElementById('comparison-block-result');
Â  Â  Â  Â  const comparisonSecondaryMessageP = document.getElementById('comparison-secondary-message');
Â  Â  Â  Â  const currentTimeDisplay = document.getElementById('current-time-display');

Â  Â  Â  Â  const performerNameInput = document.getElementById('performer-name');
Â  Â  Â  Â  const verifierNameInput = document.getElementById('verifier-name');
Â  Â  Â  Â  const sendDataButton = document.getElementById('send-data-button');
Â  Â  Â  Â  const sendStatusMessage = document.getElementById('send-status-message');

Â  Â  Â  Â  let code1 = null;
Â  Â  Â  Â  let code2 = null;
Â  Â  Â  Â  let currentScanTarget = 0;
Â  Â  Â  Â  let animationFrameId = null;

Â  Â  Â  Â  function updateCurrentTime() {
Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  const year = now.getFullYear();
Â  Â  Â  Â  Â  Â  const month = (now.getMonth() + 1).toString().padStart(2, '0');
Â  Â  Â  Â  Â  Â  const day = now.getDate().toString().padStart(2, '0');
Â  Â  Â  Â  Â  Â  const hours = now.getHours().toString().padStart(2, '0');
Â  Â  Â  Â  Â  Â  const minutes = now.getMinutes().toString().padStart(2, '0');

Â  Â  Â  Â  Â  Â  currentTimeDisplay.textContent = `ç¾åœ¨æ™‚åˆ»: ${year}å¹´${month}æœˆ${day}æ—¥ ${hours}æ™‚${minutes}åˆ†`;
Â  Â  Â  Â  }

Â  Â  Â  Â  async function startCamera() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
Â  Â  Â  Â  Â  Â  Â  Â  video.srcObject = stream;
Â  Â  Â  Â  Â  Â  Â  Â  video.setAttribute('playsinline', true);
Â  Â  Â  Â  Â  Â  Â  Â  video.play();

Â  Â  Â  Â  Â  Â  Â  Â  scanStatusSpan.textContent = 'æº–å‚™ãŒã§ãã¾ã—ãŸã€‚ã€ŒQRã‚³ãƒ¼ãƒ‰ï¼ˆï¼‘ï¼‰ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚';
Â  Â  Â  Â  Â  Â  Â  Â  cameraErrorDiv.style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  animationFrameId = requestAnimationFrame(tick);
Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼:', err);
Â  Â  Â  Â  Â  Â  Â  Â  cameraErrorDiv.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  scanStatusSpan.textContent = 'ã‚«ãƒ¡ãƒ©èµ·å‹•å¤±æ•—';
Â  Â  Â  Â  Â  Â  Â  Â  disableButtons();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function tick() {
Â  Â  Â  Â  Â  Â  if (video.readyState === video.HAVE_ENOUGH_DATA) {
Â  Â  Â  Â  Â  Â  Â  Â  if (canvas.width !== video.videoWidth || canvas.height !== video.videoHeight) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.width = video.videoWidth;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.height = video.videoHeight;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  canvasContext.drawImage(video, 0, 0, canvas.width, canvas.height);

Â  Â  Â  Â  Â  Â  Â  Â  if (currentScanTarget > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imageData = canvasContext.getImageData(0, 0, canvas.width, canvas.height);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const code = jsQR(imageData.data, imageData.width, imageData.height, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inversionAttempts: "dontInvert",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (code) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  drawBoundingBox(code.location);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentCode = code.data;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentScanTarget === 1 && code1 === null) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  code1 = currentCode;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  code1ResultSpan.innerHTML = `<span class="scanned-code">${escapeHTML(code1)}</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scanStatusSpan.textContent = 'æœ€åˆã®QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸã€‚ã€ŒQRã‚³ãƒ¼ãƒ‰ï¼ˆï¼’ï¼‰ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentScanTarget = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scan1Button.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scan2Button.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (currentScanTarget === 2 && code2 === null && currentCode !== code1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  code2 = currentCode;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  code2ResultSpan.innerHTML = `<span class="scanned-code">${escapeHTML(code2)}</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scanStatusSpan.textContent = '2ç•ªç›®ã®QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸã€‚';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentScanTarget = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scan2Button.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  compareCodes();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (currentScanTarget === 2 && currentCode === code1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // console.log("Code2ã‚¹ã‚­ãƒ£ãƒ³ä¸­ã«Code1ã¨åŒã˜ã‚³ãƒ¼ãƒ‰ã‚’æ¤œå‡ºã€‚ç•°ãªã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å¾…æ©Ÿã€‚");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  animationFrameId = requestAnimationFrame(tick);
Â  Â  Â  Â  }

Â  Â  Â  Â  function drawBoundingBox(location) {
Â  Â  Â  Â  Â  Â  canvasContext.strokeStyle = "#FF0000";
Â  Â  Â  Â  Â  Â  canvasContext.lineWidth = 4;
Â  Â  Â  Â  Â  Â  canvasContext.beginPath();
Â  Â  Â  Â  Â  Â  canvasContext.moveTo(location.topLeftCorner.x, location.topLeftCorner.y);
Â  Â  Â  Â  Â  Â  canvasContext.lineTo(location.topRightCorner.x, location.topRightCorner.y);
Â  Â  Â  Â  Â  Â  canvasContext.lineTo(location.bottomRightCorner.x, location.bottomRightCorner.y);
Â  Â  Â  Â  Â  Â  canvasContext.lineTo(location.bottomLeftCorner.x, location.bottomLeftCorner.y);
Â  Â  Â  Â  Â  Â  canvasContext.lineTo(location.topLeftCorner.x, location.topLeftCorner.y);
Â  Â  Â  Â  Â  Â  canvasContext.stroke();
Â  Â  Â  Â  }

Â  Â  Â  Â  function compareCodes() {
Â  Â  Â  Â  Â  Â  if (code1 !== null && code2 !== null) {
Â  Â  Â  Â  Â  Â  Â  Â  const firstTwoCode1 = code1.substring(0, 2);
Â  Â  Â  Â  Â  Â  Â  Â  const firstTwoCode2 = code2.substring(0, 2);

Â  Â  Â  Â  Â  Â  Â  Â  let isMatch = false;

Â  Â  Â  Â  Â  Â  Â  Â  if (firstTwoCode1 === firstTwoCode2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isMatch = false;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const restCode1 = code1.substring(2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const restCode2 = code2.substring(2);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (restCode1 === restCode2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isMatch = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isMatch = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (isMatch) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.textContent = 'OK';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.className = 'match';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.textContent = 'ETCç•ªå·ãŒä¸€è‡´ã—ã¾ã—ãŸ';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.className = 'match';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.textContent = 'NG';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.className = 'mismatch';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.textContent = 'ETCç•ªå·ãŒä¸€è‡´ã—ã¾ã›ã‚“ã§ã—ãŸ';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.className = 'mismatch';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  checkIfReadyToSend();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.textContent = '---';
Â  Â  Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.className = '';
Â  Â  Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.textContent = '---';
Â  Â  Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.className = '';
Â  Â  Â  Â  Â  Â  Â  Â  checkIfReadyToSend();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function disableButtons() {
Â  Â  Â  Â  Â  Â  scan1Button.disabled = true;
Â  Â  Â  Â  Â  Â  scan2Button.disabled = true;
Â  Â  Â  Â  Â  Â  resetButton.disabled = true;
Â  Â  Â  Â  Â  Â  sendDataButton.disabled = true;
Â  Â  Â  Â  }

Â  Â  Â  Â  scan1Button.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (code1 === null && currentScanTarget === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  currentScanTarget = 1;
Â  Â  Â  Â  Â  Â  Â  Â  scanStatusSpan.textContent = 'æœ€åˆã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­...';
Â  Â  Â  Â  Â  Â  Â  Â  scan1Button.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.textContent = '---';
Â  Â  Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.className = '';
Â  Â  Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.textContent = '---';
Â  Â  Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.className = '';
Â  Â  Â  Â  Â  Â  Â  Â  checkIfReadyToSend();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  scan2Button.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (code1 !== null && code2 === null && currentScanTarget === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  currentScanTarget = 2;
Â  Â  Â  Â  Â  Â  Â  Â  scanStatusSpan.textContent = '2ç•ªç›®ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­... (æœ€åˆã®ã‚³ãƒ¼ãƒ‰ã¨ç•°ãªã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ã‹ã–ã—ã¦ãã ã•ã„)';
Â  Â  Â  Â  Â  Â  Â  Â  scan2Button.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.textContent = '---';
Â  Â  Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.className = '';
Â  Â  Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.textContent = '---';
Â  Â  Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.className = '';
Â  Â  Â  Â  Â  Â  Â  Â  checkIfReadyToSend();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  resetButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  currentScanTarget = 0;
Â  Â  Â  Â  Â  Â  code1 = null;
Â  Â  Â  Â  Â  Â  code2 = null;
Â  Â  Â  Â  Â  Â  code1ResultSpan.textContent = '---';
Â  Â  Â  Â  Â  Â  code2ResultSpan.textContent = '---';
Â  Â  Â  Â  Â  Â  scanStatusSpan.textContent = 'æº–å‚™ãŒã§ãã¾ã—ãŸã€‚ã€ŒQRã‚³ãƒ¼ãƒ‰ï¼ˆï¼‘ï¼‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚';
Â  Â  Â  Â  Â  Â  scan1Button.disabled = false;
Â  Â  Â  Â  Â  Â  scan2Button.disabled = true;
Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.textContent = '---';
Â  Â  Â  Â  Â  Â  comparisonBlockResultDiv.className = '';
Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.textContent = '---';
Â  Â  Â  Â  Â  Â  comparisonSecondaryMessageP.className = '';
Â  Â  Â  Â  Â  Â  canvasContext.clearRect(0, 0, canvas.width, canvas.height);
Â  Â  Â  Â  Â  Â  if (video.readyState === video.HAVE_ENOUGH_DATA) {
Â  Â  Â  Â  Â  Â  Â  Â  canvasContext.drawImage(video, 0, 0, canvas.width, canvas.height);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  checkIfReadyToSend();
Â  Â  Â  Â  });

Â  Â  Â  Â  function escapeHTML(str) {
Â  Â  Â  Â  Â  Â  return str.replace(/&/g, '&amp;')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/</g, '&lt;')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/>/g, '&gt;')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/"/g, '&quot;')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/'/g, '&#39;');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function checkIfReadyToSend() {
Â  Â  Â  Â  Â  Â  const isMatchOK = comparisonBlockResultDiv.textContent === 'OK';
Â  Â  Â  Â  Â  Â  const isPerformerNameEntered = performerNameInput.value.trim() !== '';
Â  Â  Â  Â  Â  Â  const isVerifierNameEntered = verifierNameInput.value.trim() !== '';

Â  Â  Â  Â  Â  Â  sendDataButton.disabled = !(isMatchOK && isPerformerNameEntered && isVerifierNameEntered);
Â  Â  Â  Â  }

Â  Â  Â  Â  async function sendDataToApi() {
Â  Â  Â  Â  Â  Â  const endpointUrl = 'https://script.google.com/macros/s/AKfycbzZxMMS1yUPxs9fw1nmcQN9VVjS4vly6w1-Z1u-_VuDuZTm0X5GviisnMVIUJpEL1GGug/exec';

Â  Â  Â  Â  Â  Â  const dataToSend = {
Â  Â  Â  Â  Â  Â  Â  Â  timestamp: new Date().toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' }),
Â  Â  Â  Â  Â  Â  Â  Â  performer: performerNameInput.value.trim(),
Â  Â  Â  Â  Â  Â  Â  Â  verifier: verifierNameInput.value.trim(),
Â  Â  Â  Â  Â  Â  Â  Â  result: comparisonBlockResultDiv.textContent,
Â  Â  Â  Â  Â  Â  Â  Â  code1: code1,
Â  Â  Â  Â  Â  Â  Â  Â  code2: code2
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  sendDataButton.disabled = true;
Â  Â  Â  Â  Â  Â  performerNameInput.disabled = true;
Â  Â  Â  Â  Â  Â  verifierNameInput.disabled = true;
Â  Â  Â  Â  Â  Â  sendStatusMessage.textContent = 'é€ä¿¡ä¸­...';
Â  Â  Â  Â  Â  Â  sendStatusMessage.style.color = '#333';

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(endpointUrl, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(dataToSend),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mode: 'no-cors'
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  sendStatusMessage.textContent = 'ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«é€ä¿¡ã•ã‚Œã¾ã—ãŸï¼ âœ…';
Â  Â  Â  Â  Â  Â  Â  Â  sendStatusMessage.style.color = 'green';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // é€ä¿¡æˆåŠŸå¾Œã«å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹
Â  Â  Â  Â  Â  Â  Â  Â  performerNameInput.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  verifierNameInput.value = '';

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
Â  Â  Â  Â  Â  Â  Â  Â  sendStatusMessage.textContent = 'ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚';
Â  Â  Â  Â  Â  Â  Â  Â  sendStatusMessage.style.color = 'red';

Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  sendDataButton.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  performerNameInput.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  verifierNameInput.disabled = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  sendDataButton.addEventListener('click', sendDataToApi);
Â  Â  Â  Â  performerNameInput.addEventListener('input', checkIfReadyToSend);
Â  Â  Â  Â  verifierNameInput.addEventListener('input', checkIfReadyToSend);
Â  Â  Â  Â Â 
Â  Â  Â  Â  startCamera();
Â  Â  Â  Â  updateCurrentTime();
Â  Â  Â  Â  setInterval(updateCurrentTime, 60 * 1000);
Â  Â  </script>
</body>

</html>
